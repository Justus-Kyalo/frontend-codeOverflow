{"ast":null,"code":"var _jsxFileName = \"/home/john/development/frontend-codeOverflow/src/components/VoteComponent/index.js\",\n  _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { makeVote, downVote } from \"../../store/votes\";\nimport { ReactComponent as GrayUpArrow } from './svgs/gray-up-arrow.svg';\nimport { ReactComponent as OrangeUpArrow } from './svgs/orange-up-arrow.svg';\nimport { ReactComponent as GrayDownArrow } from './svgs/gray-down-arrow.svg';\nimport { ReactComponent as OrangeDownArrow } from './svgs/orange-down-arrow.svg';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Vote = _ref => {\n  _s();\n  let {\n    post,\n    sessionUser,\n    isAnswer,\n    dispatchPost\n  } = _ref;\n  const dispatch = useDispatch();\n  const votes = post.votesAttributes;\n  const initialVotes = votes ? votes.map(vote => {\n    return vote.vote ? 1 : -1;\n  }).reduce((vote, current) => vote + current, 0) : 0;\n  const initialVoters = votes ? votes.map(vote => {\n    return vote.voterId;\n  }) : [];\n  let initialVote = \"\";\n  const [voteCount, setVoteCount] = useState();\n  const [voters, setVoters] = useState([]);\n  const [vote, setVote] = useState(\"\");\n  if (sessionUser && votes) {\n    for (let i = 0; i < votes.length; i++) {\n      if (sessionUser.id === votes[i].voterId) initialVote = votes[i].vote;\n    }\n  }\n  useEffect(() => {\n    setVoteCount(initialVotes);\n    setVoters(initialVoters);\n    setVote(initialVote);\n  }, [initialVote, initialVotes]);\n  const handleClickGray = bool => {\n    if (!sessionUser) {\n      return alert(\"You must be logged in to vote\");\n    }\n    if (sessionUser.id === (post === null || post === void 0 ? void 0 : post.authorId) || isAnswer && sessionUser.id === (post === null || post === void 0 ? void 0 : post.answererId)) {\n      return alert(\"You cannot vote on your own post\");\n    }\n    const has_user_voted = voters.includes(sessionUser.id);\n    const user_id = sessionUser.id;\n    if (has_user_voted) {\n      for (const v of Object.values(votes || {})) {\n        if (v.voterId === sessionUser.id) {\n          dispatch(downVote(v.id, dispatchPost));\n        }\n      }\n      setVote(\"\");\n      setVoters(voters.filter(v => v !== user_id));\n    }\n    dispatch(makeVote(sessionUser.id, post.id, bool, isAnswer, dispatchPost));\n    setVote(bool);\n    setVoters([...voters, user_id]);\n    if (bool) {\n      setVoteCount(voteCount + 1);\n    } else {\n      setVoteCount(voteCount - 1);\n    }\n  };\n  const handleClickOrange = bool => {\n    // if(sessionUser.id === post?.authorId || sessionUser.id === post?.answererId) {return}\n    // if(!sessionUser){return alert(\"You must be logged in to vote\")}\n    const user_id = sessionUser.id;\n    for (const v of Object.values(votes || {})) {\n      if (v.voterId === sessionUser.id) {\n        dispatch(downVote(v.id, dispatchPost));\n      }\n    }\n    setVote(\"\");\n    setVoters(voters.filter(v => v !== user_id));\n    if (bool) {\n      setVoteCount(voteCount + 1);\n    } else {\n      setVoteCount(voteCount - 1);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"vote-container\",\n    children: [sessionUser && votes && voters.includes(sessionUser.id) && vote ? /*#__PURE__*/_jsxDEV(OrangeUpArrow, {\n      onClick: () => handleClickOrange(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 80\n    }, this) : /*#__PURE__*/_jsxDEV(GrayUpArrow, {\n      onClick: () => handleClickGray(true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 140\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"vote-count\",\n      children: voteCount\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }, this), sessionUser && votes && voters.includes(sessionUser.id) && !vote ? /*#__PURE__*/_jsxDEV(OrangeDownArrow, {\n      onClick: () => handleClickOrange(true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 81\n    }, this) : /*#__PURE__*/_jsxDEV(GrayDownArrow, {\n      onClick: () => handleClickGray(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 142\n    }, this)]\n  }, isAnswer ? `answer${post.id}` : `question${post.id}`, true, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 9\n  }, this);\n};\n_s(Vote, \"Kl2HKQmzovSfZSlGFOZ0Sx5whOI=\", false, function () {\n  return [useDispatch];\n});\n_c = Vote;\nexport default Vote;\nvar _c;\n$RefreshReg$(_c, \"Vote\");","map":{"version":3,"names":["useEffect","useState","useDispatch","makeVote","downVote","ReactComponent","GrayUpArrow","OrangeUpArrow","GrayDownArrow","OrangeDownArrow","jsxDEV","_jsxDEV","Vote","_ref","_s","post","sessionUser","isAnswer","dispatchPost","dispatch","votes","votesAttributes","initialVotes","map","vote","reduce","current","initialVoters","voterId","initialVote","voteCount","setVoteCount","voters","setVoters","setVote","i","length","id","handleClickGray","bool","alert","authorId","answererId","has_user_voted","includes","user_id","v","Object","values","filter","handleClickOrange","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/john/development/frontend-codeOverflow/src/components/VoteComponent/index.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { makeVote, downVote } from \"../../store/votes\";\nimport { ReactComponent as GrayUpArrow } from './svgs/gray-up-arrow.svg';\nimport { ReactComponent as OrangeUpArrow } from './svgs/orange-up-arrow.svg';\nimport { ReactComponent as GrayDownArrow } from './svgs/gray-down-arrow.svg';\nimport { ReactComponent as OrangeDownArrow } from './svgs/orange-down-arrow.svg';\n\n\nconst Vote = ({post, sessionUser, isAnswer, dispatchPost}) => {\n    const dispatch = useDispatch();\n    const votes = post.votesAttributes;\n\n    const initialVotes = votes ? votes.map((vote) => {return vote.vote ? 1 : -1}).reduce((vote, current) => vote + current, 0) : 0\n    const initialVoters = votes ? votes.map((vote) => {return vote.voterId}) : []\n    let initialVote = \"\"\n\n    const [voteCount, setVoteCount] = useState()\n    const [voters, setVoters] = useState([])\n    const [vote, setVote] = useState(\"\");\n\n    if(sessionUser && votes){\n        for(let i = 0; i < votes.length; i++){\n            if(sessionUser.id === votes[i].voterId) initialVote = votes[i].vote;\n        }\n    }\n\n    useEffect(() => {\n        setVoteCount(initialVotes)\n        setVoters(initialVoters)\n        setVote(initialVote)\n\n    }, [initialVote, initialVotes])\n\n\n    const handleClickGray = (bool) => {\n        if(!sessionUser){return alert(\"You must be logged in to vote\")}\n\n        if(sessionUser.id === post?.authorId || (isAnswer && sessionUser.id === post?.answererId)) {\n            return alert(\"You cannot vote on your own post\")\n        }\n        const has_user_voted = voters.includes(sessionUser.id)\n        const user_id = sessionUser.id\n\n        if(has_user_voted) {\n            for (const v of Object.values(votes || {})) {\n                if(v.voterId === sessionUser.id) {\n                    dispatch(downVote(v.id, dispatchPost))\n                }\n            }\n            setVote(\"\")\n            setVoters(voters.filter(v => v !== user_id))\n        }\n        dispatch(makeVote(sessionUser.id, post.id, bool, isAnswer, dispatchPost));\n        setVote(bool)\n        setVoters([...voters, user_id])\n        if(bool){\n            setVoteCount(voteCount + 1)\n        }else{\n            setVoteCount(voteCount - 1)\n        }\n    }\n\n\n    const handleClickOrange = (bool) => {\n        // if(sessionUser.id === post?.authorId || sessionUser.id === post?.answererId) {return}\n        // if(!sessionUser){return alert(\"You must be logged in to vote\")}\n        const user_id = sessionUser.id\n\n        for (const v of Object.values(votes || {})) {\n            if(v.voterId === sessionUser.id) {\n                dispatch(downVote(v.id, dispatchPost))\n            }\n        }\n        setVote(\"\")\n        setVoters(voters.filter(v => v !== user_id))\n\n        if(bool){\n            setVoteCount(voteCount + 1)\n        }else{\n            setVoteCount(voteCount - 1)\n        }\n    }\n\n\n    return(\n        <div className=\"vote-container\" key={isAnswer ? `answer${post.id}` : `question${post.id}`}>\n            {sessionUser && votes && voters.includes(sessionUser.id) && vote ? <OrangeUpArrow onClick={() => handleClickOrange(false)}/> : <GrayUpArrow onClick={() => handleClickGray(true)}/>}\n            <h1 className=\"vote-count\">{voteCount}</h1>\n            {sessionUser && votes && voters.includes(sessionUser.id) && !vote ? <OrangeDownArrow onClick={() => handleClickOrange(true)}/> : <GrayDownArrow onClick={() => handleClickGray(false)}/>}\n        </div>\n    )\n}\n\nexport default Vote;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}