{"ast":null,"code":"import { objectToSearchString } from \"./objectToSearchString\";\nimport { searchStringToObject } from \".\";\nconst JSON_SAFE_CHARS = `{}[],\":`.split(\"\").map(d => [d, encodeURIComponent(d)]);\nfunction getHrefFromLocation(location, search) {\n  let href = search;\n  if (location.href) {\n    try {\n      const url = new URL(location.href);\n      href = `${url.origin}${url.pathname}${search}`;\n    } catch (e) {\n      href = \"\";\n    }\n  }\n  return href;\n}\nfunction transformSearchStringJsonSafe(searchString) {\n  let str = searchString;\n  for (let [char, code] of JSON_SAFE_CHARS) {\n    str = str.replace(new RegExp(\"\\\\\" + code, \"g\"), char);\n  }\n  return str;\n}\nfunction updateLocation(encodedQuery, location) {\n  let objectToSearchStringFn = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : objectToSearchString;\n  let encodedSearchString = objectToSearchStringFn(encodedQuery);\n  const search = encodedSearchString.length ? `?${encodedSearchString}` : \"\";\n  const newLocation = {\n    ...location,\n    key: `${Date.now()}`,\n    href: getHrefFromLocation(location, search),\n    search,\n    query: encodedQuery\n  };\n  return newLocation;\n}\nfunction updateInLocation(encodedQueryReplacements, location) {\n  let objectToSearchStringFn = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : objectToSearchString;\n  let searchStringToObjectFn = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : searchStringToObject;\n  const currQuery = searchStringToObjectFn(location.search);\n  const newQuery = {\n    ...currQuery,\n    ...encodedQueryReplacements\n  };\n  return updateLocation(newQuery, location, objectToSearchStringFn);\n}\nexport { transformSearchStringJsonSafe, updateInLocation, updateLocation };","map":{"version":3,"names":["objectToSearchString","searchStringToObject","JSON_SAFE_CHARS","split","map","d","encodeURIComponent","getHrefFromLocation","location","search","href","url","URL","origin","pathname","e","transformSearchStringJsonSafe","searchString","str","char","code","replace","RegExp","updateLocation","encodedQuery","objectToSearchStringFn","arguments","length","undefined","encodedSearchString","newLocation","key","Date","now","query","updateInLocation","encodedQueryReplacements","searchStringToObjectFn","currQuery","newQuery"],"sources":["/home/remmy/Documents/Development/code/wakuu/frontend/node_modules/serialize-query-params/src/updateLocation.ts"],"sourcesContent":["import { EncodedQuery } from './types';\nimport { objectToSearchString } from './objectToSearchString';\nimport { searchStringToObject } from '.';\n\n/**\n * An example of a transformSearchString function that undoes encoding of\n * common JSON characters that are technically allowed in URLs.\n */\nconst JSON_SAFE_CHARS = `{}[],\":`\n  .split('')\n  .map((d) => [d, encodeURIComponent(d)]);\n\nfunction getHrefFromLocation(location: Location, search: string): string {\n  // https://developer.mozilla.org/en-US/docs/Web/API/URL/URL\n  let href: string = search;\n\n  if (location.href) {\n      // TODO - implement base option if location.href is relative\n      //  see https://developer.mozilla.org/en-US/docs/Web/API/URL/URL#syntax\n    try {\n      const url = new URL(location.href);\n      href = `${url.origin}${url.pathname}${search}`;\n    } catch (e) {\n      href = '';\n    }\n  }\n\n  return href;\n}\n\nexport function transformSearchStringJsonSafe(searchString: string): string {\n  let str = searchString;\n  for (let [char, code] of JSON_SAFE_CHARS) {\n    str = str.replace(new RegExp('\\\\' + code, 'g'), char);\n  }\n  return str;\n}\n\n/**\n * Update a location, wiping out parameters not included in encodedQuery\n * If a param is set to undefined it will be removed from the URL.\n */\nexport function updateLocation(\n  encodedQuery: EncodedQuery,\n  location: Location,\n  objectToSearchStringFn = objectToSearchString\n): Location {\n  let encodedSearchString = objectToSearchStringFn(encodedQuery);\n\n  const search = encodedSearchString.length ? `?${encodedSearchString}` : '';\n\n  const newLocation: Location & {\n    key: string;\n    query: EncodedQuery;\n  } = {\n    ...location,\n    key: `${Date.now()}`, // needed for some routers (e.g. react-router)\n    href: getHrefFromLocation(location, search),\n    search,\n    query: encodedQuery, // needed for some routers (e.g. found)\n  };\n\n  return newLocation;\n}\n\n/**\n * Update a location while retaining existing parameters.\n * If a param is set to undefined it will be removed from the URL.\n */\nexport function updateInLocation(\n  encodedQueryReplacements: EncodedQuery,\n  location: Location,\n  objectToSearchStringFn = objectToSearchString,\n  searchStringToObjectFn = searchStringToObject\n): Location {\n  // explicitly avoid parsing numbers to ensure the\n  // return type has the same shape as EncodeQuery\n  const currQuery = searchStringToObjectFn(location.search);\n\n  const newQuery = {\n    ...currQuery,\n    ...encodedQueryReplacements,\n  };\n\n  return updateLocation(newQuery, location, objectToSearchStringFn);\n}\n"],"mappings":"AACA,SAASA,oBAAA,QAA4B;AACrC,SAASC,oBAAA,QAA4B;AAMrC,MAAMC,eAAA,GAAkB,UACrBC,KAAA,CAAM,EAAE,EACRC,GAAA,CAAKC,CAAA,IAAM,CAACA,CAAA,EAAGC,kBAAA,CAAmBD,CAAC,CAAC,CAAC;AAExC,SAASE,oBAAoBC,QAAA,EAAoBC,MAAA,EAAwB;EAEvE,IAAIC,IAAA,GAAeD,MAAA;EAEnB,IAAID,QAAA,CAASE,IAAA,EAAM;IAGjB,IAAI;MACF,MAAMC,GAAA,GAAM,IAAIC,GAAA,CAAIJ,QAAA,CAASE,IAAI;MACjCA,IAAA,GAAO,GAAGC,GAAA,CAAIE,MAAA,GAASF,GAAA,CAAIG,QAAA,GAAWL,MAAA;IACxC,SAASM,CAAA,EAAP;MACAL,IAAA,GAAO;IACT;EACF;EAEA,OAAOA,IAAA;AACT;AAEO,SAASM,8BAA8BC,YAAA,EAA8B;EAC1E,IAAIC,GAAA,GAAMD,YAAA;EACV,SAAS,CAACE,IAAA,EAAMC,IAAI,KAAKlB,eAAA,EAAiB;IACxCgB,GAAA,GAAMA,GAAA,CAAIG,OAAA,CAAQ,IAAIC,MAAA,CAAO,OAAOF,IAAA,EAAM,GAAG,GAAGD,IAAI;EACtD;EACA,OAAOD,GAAA;AACT;AAMO,SAASK,eACdC,YAAA,EACAhB,QAAA,EAEU;EAAA,IADViB,sBAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAyB1B,oBAAA;EAEzB,IAAI6B,mBAAA,GAAsBJ,sBAAA,CAAuBD,YAAY;EAE7D,MAAMf,MAAA,GAASoB,mBAAA,CAAoBF,MAAA,GAAS,IAAIE,mBAAA,KAAwB;EAExE,MAAMC,WAAA,GAGF;IACF,GAAGtB,QAAA;IACHuB,GAAA,EAAK,GAAGC,IAAA,CAAKC,GAAA,EAAI;IACjBvB,IAAA,EAAMH,mBAAA,CAAoBC,QAAA,EAAUC,MAAM;IAC1CA,MAAA;IACAyB,KAAA,EAAOV;EACT;EAEA,OAAOM,WAAA;AACT;AAMO,SAASK,iBACdC,wBAAA,EACA5B,QAAA,EAGU;EAAA,IAFViB,sBAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAyB1B,oBAAA;EAAA,IACzBqC,sBAAA,GAAAX,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAyBzB,oBAAA;EAIzB,MAAMqC,SAAA,GAAYD,sBAAA,CAAuB7B,QAAA,CAASC,MAAM;EAExD,MAAM8B,QAAA,GAAW;IACf,GAAGD,SAAA;IACH,GAAGF;EACL;EAEA,OAAOb,cAAA,CAAegB,QAAA,EAAU/B,QAAA,EAAUiB,sBAAsB;AAClE"},"metadata":{},"sourceType":"module","externalDependencies":[]}